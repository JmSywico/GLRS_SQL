{"ast":null,"code":"import express from 'express';\nimport pool from '../db.js';\nconst router = express.Router();\n\n// Get all ratings for a specific game\nrouter.get('/:gameId', async (req, res) => {\n  try {\n    const {\n      gameId\n    } = req.params;\n    const result = await pool.query(`SELECT r.*, u.username \n       FROM ratings r \n       JOIN users u ON r.user_id = u.user_id \n       WHERE r.game_id = $1 \n       ORDER BY r.created_at DESC`, [gameId]);\n\n    // Always return an array, even if empty\n    res.json(result.rows);\n  } catch (err) {\n    console.error('Error fetching ratings:', err);\n    // Return empty array on error instead of error object\n    res.status(500).json([]);\n  }\n});\n\n// Get a specific user's rating for a game\nrouter.get('/:gameId/:userId', async (req, res) => {\n  try {\n    const {\n      gameId,\n      userId\n    } = req.params;\n    const result = await pool.query(`SELECT * FROM ratings \n       WHERE game_id = $1 AND user_id = $2`, [gameId, userId]);\n    res.json(result.rows[0] || null);\n  } catch (err) {\n    console.error('Error fetching user rating:', err);\n    res.status(500).json({\n      error: err.message\n    });\n  }\n});\n\n// Add or update a rating\nrouter.post('/', async (req, res) => {\n  try {\n    const {\n      user_id,\n      game_id,\n      rating,\n      review_text\n    } = req.body;\n\n    // Generate rating_id\n    const countResult = await pool.query('SELECT COUNT(*) FROM ratings');\n    const newId = `R${String(parseInt(countResult.rows[0].count) + 1).padStart(3, '0')}`;\n\n    // Check if rating already exists\n    const existing = await pool.query('SELECT rating_id FROM ratings WHERE user_id = $1 AND game_id = $2', [user_id, game_id]);\n    let result;\n    if (existing.rows.length > 0) {\n      // Update existing rating\n      result = await pool.query(`UPDATE ratings \n         SET rating = $1, review_text = $2, created_at = NOW()\n         WHERE user_id = $3 AND game_id = $4\n         RETURNING *`, [rating, review_text, user_id, game_id]);\n    } else {\n      // Insert new rating\n      result = await pool.query(`INSERT INTO ratings (rating_id, user_id, game_id, rating, review_text, created_at)\n         VALUES ($1, $2, $3, $4, $5, NOW())\n         RETURNING *`, [newId, user_id, game_id, rating, review_text]);\n    }\n    res.json(result.rows[0]);\n  } catch (err) {\n    console.error('Error saving rating:', err);\n    res.status(500).json({\n      error: err.message\n    });\n  }\n});\n\n// Delete a rating\nrouter.delete('/:ratingId', async (req, res) => {\n  try {\n    const {\n      ratingId\n    } = req.params;\n    const result = await pool.query('DELETE FROM ratings WHERE rating_id = $1 RETURNING *', [ratingId]);\n    if (result.rows.length === 0) {\n      return res.status(404).json({\n        error: 'Rating not found'\n      });\n    }\n    res.json({\n      message: 'Rating deleted',\n      rating: result.rows[0]\n    });\n  } catch (err) {\n    console.error('Error deleting rating:', err);\n    res.status(500).json({\n      error: err.message\n    });\n  }\n});\nexport default router;","map":{"version":3,"names":["express","pool","router","Router","get","req","res","gameId","params","result","query","json","rows","err","console","error","status","userId","message","post","user_id","game_id","rating","review_text","body","countResult","newId","String","parseInt","count","padStart","existing","length","delete","ratingId"],"sources":["C:/Users/Paul/Documents/School Stuff/programming/gdinfmg/GLRS_SQL/SQL/glrs-client/src/components/Ratings.js"],"sourcesContent":["import express from 'express';\r\nimport pool from '../db.js';\r\n\r\nconst router = express.Router();\r\n\r\n// Get all ratings for a specific game\r\nrouter.get('/:gameId', async (req, res) => {\r\n  try {\r\n    const { gameId } = req.params;\r\n    const result = await pool.query(\r\n      `SELECT r.*, u.username \r\n       FROM ratings r \r\n       JOIN users u ON r.user_id = u.user_id \r\n       WHERE r.game_id = $1 \r\n       ORDER BY r.created_at DESC`,\r\n      [gameId]\r\n    );\r\n    \r\n    // Always return an array, even if empty\r\n    res.json(result.rows);\r\n  } catch (err) {\r\n    console.error('Error fetching ratings:', err);\r\n    // Return empty array on error instead of error object\r\n    res.status(500).json([]);\r\n  }\r\n});\r\n\r\n// Get a specific user's rating for a game\r\nrouter.get('/:gameId/:userId', async (req, res) => {\r\n  try {\r\n    const { gameId, userId } = req.params;\r\n    const result = await pool.query(\r\n      `SELECT * FROM ratings \r\n       WHERE game_id = $1 AND user_id = $2`,\r\n      [gameId, userId]\r\n    );\r\n    \r\n    res.json(result.rows[0] || null);\r\n  } catch (err) {\r\n    console.error('Error fetching user rating:', err);\r\n    res.status(500).json({ error: err.message });\r\n  }\r\n});\r\n\r\n// Add or update a rating\r\nrouter.post('/', async (req, res) => {\r\n  try {\r\n    const { user_id, game_id, rating, review_text } = req.body;\r\n    \r\n    // Generate rating_id\r\n    const countResult = await pool.query('SELECT COUNT(*) FROM ratings');\r\n    const newId = `R${String(parseInt(countResult.rows[0].count) + 1).padStart(3, '0')}`;\r\n    \r\n    // Check if rating already exists\r\n    const existing = await pool.query(\r\n      'SELECT rating_id FROM ratings WHERE user_id = $1 AND game_id = $2',\r\n      [user_id, game_id]\r\n    );\r\n    \r\n    let result;\r\n    if (existing.rows.length > 0) {\r\n      // Update existing rating\r\n      result = await pool.query(\r\n        `UPDATE ratings \r\n         SET rating = $1, review_text = $2, created_at = NOW()\r\n         WHERE user_id = $3 AND game_id = $4\r\n         RETURNING *`,\r\n        [rating, review_text, user_id, game_id]\r\n      );\r\n    } else {\r\n      // Insert new rating\r\n      result = await pool.query(\r\n        `INSERT INTO ratings (rating_id, user_id, game_id, rating, review_text, created_at)\r\n         VALUES ($1, $2, $3, $4, $5, NOW())\r\n         RETURNING *`,\r\n        [newId, user_id, game_id, rating, review_text]\r\n      );\r\n    }\r\n    \r\n    res.json(result.rows[0]);\r\n  } catch (err) {\r\n    console.error('Error saving rating:', err);\r\n    res.status(500).json({ error: err.message });\r\n  }\r\n});\r\n\r\n// Delete a rating\r\nrouter.delete('/:ratingId', async (req, res) => {\r\n  try {\r\n    const { ratingId } = req.params;\r\n    \r\n    const result = await pool.query(\r\n      'DELETE FROM ratings WHERE rating_id = $1 RETURNING *',\r\n      [ratingId]\r\n    );\r\n    \r\n    if (result.rows.length === 0) {\r\n      return res.status(404).json({ error: 'Rating not found' });\r\n    }\r\n    \r\n    res.json({ message: 'Rating deleted', rating: result.rows[0] });\r\n  } catch (err) {\r\n    console.error('Error deleting rating:', err);\r\n    res.status(500).json({ error: err.message });\r\n  }\r\n});\r\n\r\nexport default router;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}